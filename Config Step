sudo nano /etc/hostsâ€¨10.10.1.226   ldap01
10.10.1.227   ldap02
10.10.1.228   ldap03

getent hosts ldap02
getent hosts ldap03


STEP 1 â€“ Set timezone (samakan dulu)

Jalankan di:

ldap01

ldap02

ldap03

sudo timedatectl set-timezone Asia/Jakarta


Cek:

timedatectl


Pastikan:

Time zone: Asia/Jakarta

âœ… STEP 2 â€“ Aktifkan NTP bawaan systemd

Di semua server:

sudo timedatectl set-ntp true

âœ… STEP 3 â€“ Pastikan service time sync aktif

Di semua server:

systemctl status systemd-timesyncd


Harusnya:

Active: active (running)


Kalau belum aktif:

sudo systemctl enable --now systemd-timesyncd

âœ… STEP 4 â€“ Paksa refresh sinkronisasi

Di semua server:

sudo systemctl restart systemd-timesyncd


Tunggu Â±10â€“20 detik.

âœ… STEP 5 â€“ Cek apakah sudah sinkron

Di masing-masing server:

timedatectl


Yang penting:

System clock synchronized: yes
NTP service: active

âœ… STEP 6 â€“ Cek jam real (bandingkan antar server)

Di ldap01:

date


Di ldap02:

date


Di ldap03:

date


Selisih harusnya hanya mili-detik / detik.


===============================
ðŸ”µ BAGIAN 1 â€“ ldap01 (10.10.1.226)
===============================

Jalankan SEMUA di ldap01

1ï¸âƒ£ Pastikan ldapi aktif
grep SLAPD_SERVICES /etc/default/slapd


Harus:

SLAPD_SERVICES="ldap:/// ldapi:///"


Kalau belum, edit dan restart:

nano /etc/default/slapd
systemctl restart slapd

2ï¸âƒ£ Test akses cn=config
ldapsearch -Y EXTERNAL -H ldapi:/// -b cn=config dn | head


Harus keluar banyak dn.

3ï¸âƒ£ Cek nomor database mdb
ldapsearch -Y EXTERNAL -H ldapi:/// -b cn=config '(olcDatabase=mdb)' dn


âž¡ï¸ Catat.

Biasanya:

dn: olcDatabase={1}mdb,cn=config


Saya asumsikan:

ðŸ‘‰ {1}

4ï¸âƒ£ Set serverID (ldap01)
cat > serverid.ldif <<EOF
dn: cn=config
changetype: modify
add: olcServerID
olcServerID: 1 ldap://ldap01
EOF

ldapmodify -Y EXTERNAL -H ldapi:/// -f serverid.ldif


Cek:

ldapsearch -Y EXTERNAL -H ldapi:/// -b cn=config olcServerID

5ï¸âƒ£ Load module syncprov
cat > syncprov-module.ldif <<EOF
dn: cn=module{0},cn=config
changetype: modify
add: olcModuleLoad
olcModuleLoad: syncprov
EOF

ldapmodify -Y EXTERNAL -H ldapi:/// -f syncprov-module.ldif

6ï¸âƒ£ Pasang overlay syncprov
cat > syncprov-overlay.ldif <<EOF
dn: olcOverlay=syncprov,olcDatabase={1}mdb,cn=config
objectClass: olcOverlayConfig
objectClass: olcSyncProvConfig
olcOverlay: syncprov
olcSpCheckpoint: 100 10
olcSpSessionlog: 100
EOF

ldapadd -Y EXTERNAL -H ldapi:/// -f syncprov-overlay.ldif

7ï¸âƒ£ Konfigurasi syncrepl ldap01
cat > syncrepl.ldif <<EOF
dn: olcDatabase={1}mdb,cn=config
changetype: modify
add: olcSyncrepl
olcSyncrepl: rid=001
  provider=ldap://ldap02
  bindmethod=simple
  binddn="cn=admin,dc=ldap,dc=umm"
  credentials=lsibi5mill4h
  searchbase="dc=ldap,dc=umm"
  type=refreshAndPersist
  retry="5 5 300 +"
  timeout=1
  starttls=no
olcSyncrepl: rid=002
  provider=ldap://ldap03
  bindmethod=simple
  binddn="cn=admin,dc=ldap,dc=umm"
  credentials=lsibi5mill4h
  searchbase="dc=ldap,dc=umm"
  type=refreshAndPersist
  retry="5 5 300 +"
  timeout=1
  starttls=no
-
add: olcMirrorMode
olcMirrorMode: TRUE
EOF

ldapmodify -Y EXTERNAL -H ldapi:/// -f syncrepl.ldif

8ï¸âƒ£ Restart ldap01
systemctl restart slapd

===============================
ðŸŸ¢ BAGIAN 2 â€“ ldap02 (10.10.1.227)
===============================

âš ï¸ Login ke server yang benar (cek IP dulu):

ip a


Pastikan:

10.10.1.227


dan

hostnamectl set-hostname ldap02

1ï¸âƒ£ Pastikan base DN benar
ldapsearch -x -LLL -H ldap://localhost -b "" -s base namingContexts


Harus:

dc=ldap,dc=umm


Kalau belum â†’ jalankan:

dpkg-reconfigure slapd


(dengan nilai sama seperti ldap01)

2ï¸âƒ£ Pastikan ldapi aktif
grep SLAPD_SERVICES /etc/default/slapd


Pastikan:

SLAPD_SERVICES="ldap:/// ldapi:///"


Restart:

systemctl restart slapd

3ï¸âƒ£ Cek mdb
ldapsearch -Y EXTERNAL -H ldapi:/// -b cn=config '(olcDatabase=mdb)' dn


Asumsi {1}.

4ï¸âƒ£ serverID ldap02
cat > serverid.ldif <<EOF
dn: cn=config
changetype: modify
add: olcServerID
olcServerID: 2 ldap://ldap02
EOF

ldapmodify -Y EXTERNAL -H ldapi:/// -f serverid.ldif

5ï¸âƒ£ module syncprov
cat > syncprov-module.ldif <<EOF
dn: cn=module{0},cn=config
changetype: modify
add: olcModuleLoad
olcModuleLoad: syncprov
EOF

ldapmodify -Y EXTERNAL -H ldapi:/// -f syncprov-module.ldif

6ï¸âƒ£ overlay
cat > syncprov-overlay.ldif <<EOF
dn: olcOverlay=syncprov,olcDatabase={1}mdb,cn=config
objectClass: olcOverlayConfig
objectClass: olcSyncProvConfig
olcOverlay: syncprov
olcSpCheckpoint: 100 10
olcSpSessionlog: 100
EOF

ldapadd -Y EXTERNAL -H ldapi:/// -f syncprov-overlay.ldif

7ï¸âƒ£ syncrepl ldap02
cat > syncrepl.ldif <<EOF
dn: olcDatabase={1}mdb,cn=config
changetype: modify
add: olcSyncrepl
olcSyncrepl: rid=003
  provider=ldap://ldap01
  bindmethod=simple
  binddn="cn=admin,dc=ldap,dc=umm"
  credentials=lsibi5mill4h
  searchbase="dc=ldap,dc=umm"
  type=refreshAndPersist
  retry="5 5 300 +"
  timeout=1
  starttls=no
olcSyncrepl: rid=004
  provider=ldap://ldap03
  bindmethod=simple
  binddn="cn=admin,dc=ldap,dc=umm"
  credentials=lsibi5mill4h
  searchbase="dc=ldap,dc=umm"
  type=refreshAndPersist
  retry="5 5 300 +"
  timeout=1
  starttls=no
-
add: olcMirrorMode
olcMirrorMode: TRUE
EOF

ldapmodify -Y EXTERNAL -H ldapi:/// -f syncrepl.ldif

8ï¸âƒ£ restart
systemctl restart slapd

===============================
ðŸŸ£ BAGIAN 3 â€“ ldap03 (10.10.1.228)
===============================

Login ke ldap03 (cek IP).

1ï¸âƒ£ hostname
hostnamectl set-hostname ldap03

2ï¸âƒ£ base DN
ldapsearch -x -LLL -H ldap://localhost -b "" -s base namingContexts


Harus:

dc=ldap,dc=umm

3ï¸âƒ£ ldapi
grep SLAPD_SERVICES /etc/default/slapd
systemctl restart slapd

4ï¸âƒ£ cek mdb
ldapsearch -Y EXTERNAL -H ldapi:/// -b cn=config '(olcDatabase=mdb)' dn

5ï¸âƒ£ serverID ldap03
cat > serverid.ldif <<EOF
dn: cn=config
changetype: modify
add: olcServerID
olcServerID: 3 ldap://ldap03
EOF

ldapmodify -Y EXTERNAL -H ldapi:/// -f serverid.ldif

6ï¸âƒ£ module
cat > syncprov-module.ldif <<EOF
dn: cn=module{0},cn=config
changetype: modify
add: olcModuleLoad
olcModuleLoad: syncprov
EOF

ldapmodify -Y EXTERNAL -H ldapi:/// -f syncprov-module.ldif

7ï¸âƒ£ overlay
cat > syncprov-overlay.ldif <<EOF
dn: olcOverlay=syncprov,olcDatabase={1}mdb,cn=config
objectClass: olcOverlayConfig
objectClass: olcSyncProvConfig
olcOverlay: syncprov
olcSpCheckpoint: 100 10
olcSpSessionlog: 100
EOF

ldapadd -Y EXTERNAL -H ldapi:/// -f syncprov-overlay.ldif

8ï¸âƒ£ syncrepl ldap03
cat > syncrepl.ldif <<EOF
dn: olcDatabase={1}mdb,cn=config
changetype: modify
add: olcSyncrepl
olcSyncrepl: rid=005
  provider=ldap://ldap01
  bindmethod=simple
  binddn="cn=admin,dc=ldap,dc=umm"
  credentials=lsibi5mill4h
  searchbase="dc=ldap,dc=umm"
  type=refreshAndPersist
  retry="5 5 300 +"
  timeout=1
  starttls=no
olcSyncrepl: rid=006
  provider=ldap://ldap02
  bindmethod=simple
  binddn="cn=admin,dc=ldap,dc=umm"
  credentials=lsibi5mill4h
  searchbase="dc=ldap,dc=umm"
  type=refreshAndPersist
  retry="5 5 300 +"
  timeout=1
  starttls=no
-
add: olcMirrorMode
olcMirrorMode: TRUE
EOF

ldapmodify -Y EXTERNAL -H ldapi:/// -f syncrepl.ldif

9ï¸âƒ£ restart
systemctl restart slapd

===============================
ðŸ§ª TEST FINAL
===============================

Tambah data di ldap01:

ldapadd -x -D "cn=admin,dc=ldap,dc=umm" -W <<EOF
dn: ou=people,dc=ldap,dc=umm
objectClass: organizationalUnit
ou: people
EOF


Cek di ldap02:

ldapsearch -x -H ldap://ldap02 -b dc=ldap,dc=umm ou=people


Cek di ldap03:

ldapsearch -x -H ldap://ldap03 -b dc=ldap,dc=umm ou=people
